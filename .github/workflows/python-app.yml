name: FleetControl Grohe Report

on:
  workflow_dispatch:
  #schedule:
  #  - cron: '0 5 * * *'   # daily at 05:00 UTC

jobs:
  grohe-report:
    runs-on: ubuntu-latest

    env:
      CUSTOMER_NAME: Grohe
      CUSTOMER_ID:   940165de-1711-4053-88d6-23e588cc1593
      API_KEY:       ${{ secrets.GROHE_API_KEY }}
      QUERY:         "3"
      REPORT_YEAR:   ${{ github.event.inputs.year || '' }}
      REPORT_MONTH:  ${{ github.event.inputs.month || '' }}

    steps:
      - uses: actions/checkout@v4

      - name: Set up Python 3.11
        uses: actions/setup-python@v5
        with:
          python-version: 3.11

      - name: Install dependencies
        run: |
          pip install requests tzdata

      - name: Run report for Grohe
        run: |
          python FleetControl/FC_Report.py

      - name: Zip CSV and upload artifact
        run: |
          FILE=$(ls Grohe_*_patch.csv | head -n1)
          zip -j grohe-report.zip "$FILE"
        # Upload
      - uses: actions/upload-artifact@v4
        with:
          name: grohe-report
          path: grohe-report.zip
